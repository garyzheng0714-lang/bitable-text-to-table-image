## 问题定位
- 错误来源：`textContent.trim is not a function`，说明入参 `textContent` 并非字符串。
- 运行日志显示：`formItemParams.textContent` 为数组，元素形如 `{ type: 'text', text: '...' }`（富文本/分段文本）。
- 代码位置：在 `src/index.ts:82` 直接对 `textContent` 调用 `trim()` 导致异常。

## 变更方案
1. 入参归一化
- 新增 `normalizeTextContent(value)`：
  - 如果是字符串 → 直接返回；
  - 如果是数组 → 取每个元素的 `text` 拼接为一个完整字符串（保留原有换行字符）；
  - 如果是对象且含 `text` → 返回其 `text`；
  - 其它情况 → 返回空字符串。
- 将解析入口改为：`const input = normalizeTextContent(textContent); const lines = input.trim().split('\n');`

2. 域名白名单
- 按指南只能调用一次白名单添加，且需包含飞书域名与第三方域名：
  - `['feishu.cn','feishucdn.com','larksuitecdn.com','larksuite.com','htmlcsstoimage.com']`
- 移除不必要的 `imgbb` 白名单与上传逻辑，避免额外鉴权与不确定性。

3. 图片生成与返回
- 保留使用 `htmlcsstoimage` 生成 PNG；
- 读取二进制为 `ArrayBuffer`，转换为 Base64，并直接返回 `data:image/png;base64,...`（无需再上传图床）；
- 控制宽度/质量参数保证图片体积 < 10MB（如 `width: 800`, `quality: 85-90`）。

4. 解析与样式
- 标题行以 `# header:` 开头，使用 `|` 分隔列；数据行同样使用 `|` 分隔；
- 首行加深：表头使用稍深文字色与加粗，底部边线稍厚；
- 列宽自适应：按各列最大字符数估算宽度（字符×12~14px，且设最小值 80px）；
- 所有单元格居中，浅灰分隔线，白色背景；

5. 稳定性与接口使用注意
- 严禁直接 `response.json()`，统一使用 `res.text()` 后 `JSON.parse` 或 `arrayBuffer()`；
- 失败兜底：若第三方生成失败，返回简易 SVG Data URL，保证单元格可显示；

## 验证与测试
- 使用你提供的样例文本作为测试输入，校验：
  - 解析成功、行列数正确；
  - 生成的图片 Data URL 可用且体积 < 10MB；
  - 表头加深、居中、分隔线等视觉效果符合示例；
- 再测包含空行、不同列数与多语言文本，验证鲁棒性。

## 风险与回退
- 若 `htmlcsstoimage` 网络受限或白名单未生效：走 SVG 兜底；
- 若返回的 Data URL 在目标单元格不理想：可改为返回对象属性中新增 `image`（类型为文本存储 Data URL），保留现有 `imageUrl` 兼容。

确认以上方案后，我将按本计划修改 `src/index.ts`（集中在入参归一化、白名单、图片返回逻辑），并完成本地验证。