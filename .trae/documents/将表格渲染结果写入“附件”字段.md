## 问题与目标
- 当前返回的是 `data:image/...;base64,...` 的长字符串，属于“文本”展示，不是附件。
- 目标：在单元格中以“附件字段”展示，值为可下载的文件（图片），并满足不超过 10MB。

## 方案总览
- 改为生成 SVG 图片（体积小、清晰），不依赖第三方服务。
- 上传到飞书云空间，拿到 `file_token`（参考开放平台附件字段说明，附件值为包含 `file_token` 的对象数组）。
- 字段返回类型改为 `Attachment`，把 `[{ file_token, name, size, type }]` 作为主值返回。

## 关键实现
1. 文本解析
- 继续使用已修复的归一化逻辑，兼容富文本段数组；
- 解析 `# header:` 与每行 `|` 分隔的列。

2. 图片生成
- 生成 SVG：
  - 首行加深（加粗+较深文字色+加粗底边）；
  - 居中对齐、浅灰分隔线、白底；
  - 列宽按最大字符数估算，最小 80px；
- 文件名示例：`table_<recordId>.svg`；
- 控制尺寸与内容，确保小于 10MB。

3. 上传为附件
- 使用云空间上传文件接口（POST `https://open.feishu.cn/open-apis/drive/v1/files/upload_all`），拿到 `file_token`；
- 鉴权使用 `tenant_access_token`（应用身份），需要在插件中启用内置鉴权并配置相应权限：云空间读写、多维表格读写；
- `multipart/form-data` 参数：
  - `file_name`: SVG 文件名
  - `parent_type`: `explorer`
  - `parent_node`: 目标文件夹 token（可新增一个可配置入参，如“上传文件夹”）
  - `size`: 字节大小
  - `file`: 二进制内容
- 返回数据结构作为附件字段值（参考文档：附件字段说明）。

4. 字段返回
- `resultType` 改为包含 `Attachment` 类型的主属性；
- 返回：
  - `id`: 唯一标识
  - `attachments`: `[{ file_token, name, size, type: 'image/svg+xml' }]`

5. 失败兜底
- 若上传失败：返回错误码并写日志；
- 可选：降级为返回文本错误原因（仍用 Success+错误信息放在非主属性）。

## 权限与白名单
- 启用并配置 `tenant_access_token` 获取（应用身份）；
- 域名白名单：`open.feishu.cn`、`feishu.cn`、`larksuitecdn.com`、`larksuite.com`；
- 开启权限：云空间上传、下载；多维表格读写（附件字段需要）。

## 验证用例
- 使用你提供的示例文本，生成 SVG 并上传；
- 在单元格看到“附件”卡片，点击可下载；
- 检查文件大小、样式（首行加深、列宽自适应）。

## 参考文档
- 附件字段值结构与流程（上传得到 `file_token`，再写入记录）：https://open.feishu.cn/document/server-docs/docs/bitable-v1/app-table-field/attachment
- 云空间上传文件接口（`drive/v1/files/upload_all`）：https://open.feishu.cn/document/ukTMukTMukTM/uUjM5YjL1ITO24SNykjN

确认后我将按以上方案把返回值改成“附件”并完成上传流程。